<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Dashboard ‚Äì Anaya Reversed 3D Puzzles</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Simple, self-contained styles for the dashboard -->
  <style>
    :root {
      --bg: #050816;
      --bg-card: #0f172a;
      --bg-card-soft: #111827;
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.15);
      --border-subtle: #1f2937;
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --danger: #f97373;
      --radius-lg: 14px;
      --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.7);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #1d2438 0, #020617 55%, #000 100%);
      color: var(--text-main);
    }

    .page {
      max-width: 1100px;
      margin: 0 auto;
      padding: 1.5rem 1.25rem 3rem;
    }

    header {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      margin-bottom: 1.75rem;
    }

    .brand {
      display: flex;
      flex-direction: column;
      gap: 0.1rem;
    }

    .brand-title {
      font-size: 1.4rem;
      font-weight: 700;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }

    .brand-subtitle {
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .tag-pill {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.3rem 0.7rem;
      border-radius: 999px;
      font-size: 0.78rem;
      background: var(--accent-soft);
      border: 1px solid rgba(56, 189, 248, 0.4);
      color: #e0f2fe;
    }

    .tag-pill-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #22c55e;
    }

    .top-links {
      display: flex;
      gap: 0.6rem;
      align-items: center;
      flex-wrap: wrap;
    }

    .btn {
      border-radius: 999px;
      padding: 0.4rem 0.85rem;
      font-size: 0.8rem;
      border: 1px solid var(--border-subtle);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-main);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      cursor: pointer;
      transition: background 0.15s ease, transform 0.1s ease,
        border-color 0.15s ease;
    }

    .btn:hover {
      background: #020617;
      transform: translateY(-1px);
      border-color: var(--accent);
    }

    .btn-primary {
      background: linear-gradient(135deg, #22d3ee, #6366f1);
      color: #0b1120;
      border: none;
      font-weight: 600;
      box-shadow: 0 12px 30px rgba(56, 189, 248, 0.35);
    }

    .btn-primary:hover {
      filter: brightness(1.03);
      transform: translateY(-1px) translateZ(0);
    }

    main {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
      gap: 1rem;
    }

    .card {
      background: radial-gradient(circle at top left, #1e293b 0, #020617 45%);
      border-radius: var(--radius-lg);
      padding: 1rem 1.1rem;
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: -60%;
      background: radial-gradient(
        circle at 15% 0,
        rgba(56, 189, 248, 0.06),
        transparent 60%
      );
      opacity: 0.9;
      pointer-events: none;
    }

    .card-title {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin-bottom: 0.3rem;
    }

    .card-value {
      font-size: 1.6rem;
      font-weight: 700;
    }

    .card-meta {
      font-size: 0.78rem;
      color: var(--text-muted);
      margin-top: 0.35rem;
    }

    .card-pill {
      margin-top: 0.55rem;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      font-size: 0.75rem;
      padding: 0.25rem 0.55rem;
      border-radius: 999px;
      border: 1px solid rgba(56, 189, 248, 0.3);
      background: rgba(15, 23, 42, 0.9);
      color: #e0f2fe;
    }

    .layout-main {
      display: grid;
      grid-template-columns: minmax(0, 1.7fr) minmax(0, 1fr);
      gap: 1.2rem;
    }

    @media (max-width: 900px) {
      .layout-main {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .panel {
      background: var(--bg-card-soft);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      padding: 1rem 1.1rem 1.1rem;
      position: relative;
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
      gap: 0.6rem;
    }

    .panel-title {
      font-size: 1rem;
      font-weight: 600;
    }

    .panel-subtitle {
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    .search-row {
      display: flex;
      gap: 0.6rem;
      margin-bottom: 0.8rem;
      flex-wrap: wrap;
    }

    .input {
      border-radius: 999px;
      padding: 0.45rem 0.75rem;
      background: #020617;
      border: 1px solid #1f2937;
      color: var(--text-main);
      font-size: 0.85rem;
      min-width: 0;
    }

    .input:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 1px;
    }

    .badge {
      font-size: 0.75rem;
      padding: 0.2rem 0.5rem;
      border-radius: 999px;
      background: rgba(15, 23, 42, 1);
      border: 1px solid #1f2937;
      color: var(--text-muted);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8rem;
    }

    thead {
      background: #020617;
    }

    th,
    td {
      padding: 0.45rem 0.5rem;
      border-bottom: 1px solid #111827;
      text-align: left;
    }

    th {
      font-weight: 500;
      color: var(--text-muted);
      position: sticky;
      top: 0;
      background: #020617;
      z-index: 1;
    }

    tbody tr:nth-child(even) {
      background: #020617;
    }

    tbody tr:hover {
      background: rgba(15, 23, 42, 0.85);
    }

    .table-wrap {
      max-height: 360px;
      overflow: auto;
      border-radius: 10px;
      border: 1px solid #111827;
    }

    .pill-soft {
      display: inline-flex;
      align-items: center;
      padding: 0.15rem 0.5rem;
      border-radius: 999px;
      font-size: 0.72rem;
      background: rgba(15, 23, 42, 1);
      color: var(--text-muted);
    }

    .status-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      margin-right: 0.28rem;
      background: #22c55e;
    }

    .status-dot-new {
      background: #f97316;
    }

    .empty {
      font-size: 0.85rem;
      color: var(--text-muted);
      padding: 1rem 0.4rem;
    }

    .right-panel-section {
      margin-bottom: 0.9rem;
      padding-bottom: 0.7rem;
      border-bottom: 1px dashed #1f2937;
    }

    .right-panel-section:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.35rem;
      margin-top: 0.45rem;
    }

    .chip {
      font-size: 0.75rem;
      padding: 0.2rem 0.5rem;
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: #020617;
      color: var(--text-muted);
    }

    .muted-small {
      font-size: 0.75rem;
      color: var(--text-muted);
      line-height: 1.4;
    }

    .pill-highlight {
      background: rgba(37, 99, 235, 0.2);
      border: 1px solid rgba(59, 130, 246, 0.7);
      color: #dbeafe;
    }
  </style>

  <!-- Supabase client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
</head>
<body>
  <div class="page">
    <header>
      <div class="brand">
        <div class="brand-title">Admin Dashboard</div>
        <div class="brand-subtitle">Anaya Reversed 3D Puzzles ¬∑ internal view</div>
        <span class="tag-pill">
          <span class="tag-pill-dot"></span>
          Live Supabase data
        </span>
      </div>
      <div class="top-links">
        <a href="/" class="btn">‚Üê Back to site</a>
        <button id="refreshBtn" class="btn btn-primary" type="button">
          ‚ü≥ Refresh data
        </button>
      </div>
    </header>

    <main>
      <!-- Stats cards -->
      <section class="card-grid">
        <article class="card">
          <div class="card-title">Total feedback</div>
          <div id="stat-total" class="card-value">‚Äì</div>
          <div class="card-meta" id="stat-total-sub">Loading...</div>
          <div class="card-pill">
            üß© Visitors leaving comments
          </div>
        </article>

        <article class="card">
          <div class="card-title">Last 7 days</div>
          <div id="stat-week" class="card-value">‚Äì</div>
          <div class="card-meta">Messages received in the past week</div>
          <div class="card-pill">
            ‚è±Ô∏è Helps you see if traffic is picking up
          </div>
        </article>

        <article class="card">
          <div class="card-title">Latest submission</div>
          <div id="stat-latest-date" class="card-value" style="font-size: 1.1rem;">
            ‚Äì
          </div>
          <div class="card-meta" id="stat-latest-name">Waiting for data...</div>
          <div class="card-pill pill-highlight">
            üîç Use search below to inspect details
          </div>
        </article>
      </section>

      <section class="layout-main">
        <!-- Left: table -->
        <section class="panel">
          <header class="panel-header">
            <div>
              <div class="panel-title">Feedback inbox</div>
              <div class="panel-subtitle">
                Pulled directly from your Supabase table (most recent first)
              </div>
            </div>
            <span class="badge">
              <span id="badge-count">0</span> rows
            </span>
          </header>

          <div class="search-row">
            <input
              id="searchInput"
              class="input"
              placeholder="Search by name, email, or message‚Ä¶"
              type="search"
            />
            <span class="muted-small">
              Tip: start typing a name or email to quickly find a person.
            </span>
          </div>

          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Message</th>
                </tr>
              </thead>
              <tbody id="feedbackBody">
                <tr>
                  <td colspan="4" class="empty">Loading feedback‚Ä¶</td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>

        <!-- Right: quick info -->
        <aside class="panel">
          <div class="right-panel-section">
            <div class="panel-title">What this dashboard shows</div>
            <p class="muted-small">
              This page reads data from your Supabase <code>feedback</code> table
              using the public (anon) key. It never exposes your service role key.
            </p>
          </div>

          <div class="right-panel-section">
            <div class="panel-title">Ideas to extend later</div>
            <div class="chip-row">
              <span class="chip">Puzzle order requests</span>
              <span class="chip">Print status (queued / printing / done)</span>
              <span class="chip">Average response time</span>
              <span class="chip">Most requested team / design</span>
            </div>
          </div>

          <div class="right-panel-section">
            <div class="panel-title">Security note</div>
            <p class="muted-small">
              Since GitHub Pages is static, this page is not password protected.
              Treat the link as "secret" for now. If you want real login later,
              we can wire in Netlify Identity, Auth0, or Supabase Auth.
            </p>
          </div>
        </aside>
      </section>
    </main>
  </div>

  <script>
    // 1) SET THESE TWO VALUES with your Supabase project details.
    //    Use the SAME URL and public anon key you used for your form,
    //    NOT the service role key.
    const SUPABASE_URL = "https://YOUR-PROJECT-URL.supabase.co";
    const SUPABASE_ANON_KEY = "YOUR_PUBLIC_ANON_KEY_HERE";

    const supabaseClient = window.supabase.createClient(
      SUPABASE_URL,
      SUPABASE_ANON_KEY
    );

    // Cached data for search/filtering
    let allRows = [];

    async function loadFeedback() {
      const tbody = document.getElementById("feedbackBody");
      tbody.innerHTML =
        '<tr><td colspan="4" class="empty">Loading feedback‚Ä¶</td></tr>';

      const { data, error } = await supabaseClient
        .from("feedback") // <-- change if your table name is different
        .select("*")
        .order("created_at", { ascending: false });

      if (error) {
        console.error(error);
        tbody.innerHTML =
          '<tr><td colspan="4" class="empty">Error loading data. Check console.</td></tr>';
        return;
      }

      allRows = data || [];
      renderTable(allRows);
      updateStats(allRows);
    }

    function renderTable(rows) {
      const tbody = document.getElementById("feedbackBody");
      const badge = document.getElementById("badge-count");

      badge.textContent = rows.length;

      if (!rows.length) {
        tbody.innerHTML =
          '<tr><td colspan="4" class="empty">No feedback yet.</td></tr>';
        return;
      }

      tbody.innerHTML = rows
        .map((row) => {
          const date = row.created_at
            ? new Date(row.created_at).toLocaleString()
            : "N/A";

          const safe = (value) =>
            (value || "")
              .toString()
              .replace(/&/g, "&amp;")
              .replace(/</g, "&lt;")
              .replace(/>/g, "&gt;");

          return `
          <tr>
            <td><span class="pill-soft"><span class="status-dot"></span>${date}</span></td>
            <td>${safe(row.name || row.full_name || "")}</td>
            <td>${safe(row.email || "")}</td>
            <td>${safe(row.message || row.feedback || "")}</td>
          </tr>
        `;
        })
        .join("");
    }

    function updateStats(rows) {
      const totalEl = document.getElementById("stat-total");
      const totalSubEl = document.getElementById("stat-total-sub");
      const weekEl = document.getElementById("stat-week");
      const latestDateEl = document.getElementById("stat-latest-date");
      const latestNameEl = document.getElementById("stat-latest-name");

      const total = rows.length;
      totalEl.textContent = total;
      totalSubEl.textContent =
        total === 1 ? "1 message stored in Supabase." : `${total} messages stored in Supabase.`;

      const now = new Date();
      const sevenDaysAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
      const lastWeekCount = rows.filter((r) => {
        if (!r.created_at) return false;
        const d = new Date(r.created_at);
        return d >= sevenDaysAgo;
      }).length;

      weekEl.textContent = lastWeekCount;

      if (rows[0]?.created_at) {
        const d = new Date(rows[0].created_at);
        latestDateEl.textContent = d.toLocaleString();
        const nm = rows[0].name || rows[0].full_name || "(no name)";
        latestNameEl.textContent = `Most recent from ${nm}`;
      } else {
        latestDateEl.textContent = "‚Äì";
        latestNameEl.textContent = "No submissions yet.";
      }
    }

    function setupSearch() {
      const input = document.getElementById("searchInput");
      input.addEventListener("input", (e) => {
        const q = e.target.value.toLowerCase().trim();
        if (!q) {
          renderTable(allRows);
          return;
        }

        const filtered = allRows.filter((row) => {
          const fields = [
            row.name,
            row.full_name,
            row.email,
            row.message,
            row.feedback,
          ]
            .filter(Boolean)
            .map((v) => v.toString().toLowerCase());
          return fields.some((f) => f.includes(q));
        });

        renderTable(filtered);
      });
    }

    document.getElementById("refreshBtn").addEventListener("click", loadFeedback);

    // Initialize
    setupSearch();
    loadFeedback();
  </script>
</body>
</html>
